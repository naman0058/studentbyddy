<!DOCTYPE html>
<html>
	<head>
		<title>Chat</title>
		<!-- Bootstrap -->
		<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" >
		<!-- Font awesome -->
		<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.5.0/css/all.css" >
		<!-- CSS -->
		<link rel="stylesheet" type="text/css" href="/active-chat-zip/active-chat/activechatstyles.css">
	</head>
	<body>
		<div class="container-fluid h-100">
			<div class="row justify-content-center h-100">
				<div class="col-md-4 col-xl-3 chat"><div class="card mb-sm-3 mb-md-0 contacts_card">
					
					<div class="card-body contacts_body">
						<ui class="contacts">


                            <% for(i=0;i<result[2].length;i++){  %>

<a href="studentbuddyactivechat?second_party=<%=result[2][i].first_party%>">
                                <li class="<%= result[2][i].first_party === second_party ? 'active' : '' %>">
                                    <div class="d-flex bd-highlight">
                                        <div class="img_cont">
                                            <img src="https://static.turbosquid.com/Preview/001292/481/WV/_D.jpg" class="rounded-circle user_img">
                                            <!-- <span class="online_icon"></span> -->
                                        </div>
                                        <div class="user_info">
                                            <span><%=result[2][i].userfirstname%> <%=result[2][i].userlastname%></span>
                                            <!-- <p>Online</p> -->
                                        </div>
                                    </div>
                                </li>

                            </a>
                                <% }  %>




						
						
						</ui>
					</div>
					<div class="card-footer"></div>
				</div></div>
				<div class="col-md-8 col-xl-6 chat">
                    <% if(second_party) { %>
					<div class="card">





						<div class="card-header msg_head">
							<div class="d-flex bd-highlight">
								<div class="img_cont">
									<img src="https://static.turbosquid.com/Preview/001292/481/WV/_D.jpg" class="rounded-circle user_img">
									<span class="online_icon"></span>
								</div>
								<div class="user_info">
									<span><%=result[0][0].fname%> <%=result[0][0].lname%></span>
									
								</div>
								
							</div>
							<span id="action_menu_btn"><i class="fas fa-ellipsis-v"></i></span>
							
						</div>
						<div class="card-body msg_card_body" id="msg_card_body">


                            <% for(i=0; i < result[1].length; i++) { %>
                                <% if(result[1][i].first_party == first_party) { %>
                                  <% if(result[1][i].message.includes('.png')) { %>
                                   <p> <img src="/images/<%=result[1][i].message%>" class="left-image"></p>
                                  <% } else { %>
                                    <div class="d-flex justify-content-start mb-4">
                                        <div class="img_cont_msg">
                                            <img src="https://static.turbosquid.com/Preview/001292/481/WV/_D.jpg" class="rounded-circle user_img_msg">
                                        </div>
                                        <div class="msg_cotainer">
                                            <%=result[1][i].message%>
                                            <!-- <span class="msg_time">8:40 AM, Today</span> -->
                                        </div>
                                    </div>
                                  <% } %>
                                <% } else { %>
                                  <% if(result[1][i].message.includes('.png')) { %>
                                  <p> <img src="/images/<%=result[1][i].message%>" class="right-image"></p>
                                  <% } else { %>
                                    <div class="d-flex justify-content-end mb-4">
                                        <div class="msg_cotainer_send">
                                            <%=result[1][i].message%>
                                            <!-- <span class="msg_time_send">8:55 AM, Today</span> -->
                                        </div>
                                        <div class="img_cont_msg">
                                    <img src="https://avatars.hsoubcdn.com/ed57f9e6329993084a436b89498b6088?s=256" class="rounded-circle user_img_msg">
                                        </div>
                                    </div>
                                  <% } %>
                                <% } %>
                              <% } %>

							<!-- <div class="d-flex justify-content-start mb-4">
								<div class="img_cont_msg">
									<img src="https://static.turbosquid.com/Preview/001292/481/WV/_D.jpg" class="rounded-circle user_img_msg">
								</div>
								<div class="msg_cotainer">
									Hi, how are you samim?
									<span class="msg_time">8:40 AM, Today</span>
								</div>
							</div>

							<div class="d-flex justify-content-end mb-4">
								<div class="msg_cotainer_send">
									Hi Khalid i am good tnx how about you?
									<span class="msg_time_send">8:55 AM, Today</span>
								</div>
								<div class="img_cont_msg">
							<img src="https://avatars.hsoubcdn.com/ed57f9e6329993084a436b89498b6088?s=256" class="rounded-circle user_img_msg">
								</div>
							</div> -->
							
						</div>
						<div class="card-footer">
      <form id="myForm" action="/studentbuddyactivechat/submit" method="post" enctype="multipart/form-data">

							<div class="input-group">

                                <div class="upload-icon input-group-append">
                                    <input type="file" name="image" id="fileUpload" style="display:none" onchange="uploadImage()" multiple>
                                    <input type="hidden" name="first_party" value="<%=first_party%>">
                                    <input type="hidden" name="second_party" value="<%=second_party%>">
                    
                                    <label for="fileUpload"><i class="input-group-text attach_btn fas fa-paperclip"></i></label>
                                </div>

							
								<input type="text" name="message" required class="form-control" placeholder="Type your message...">
								<div class="input-group-append">
									<span class="input-group-text send_btn"><i class="fas fa-location-arrow"></i></span>
								</div>
							</div>
                        </form>
						</div>
                    
					</div>
                    <% } %>
				</div>
			</div>
		</div>
	<!-- JQuery -->
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
	<script type="text/javascript" src="active-chat-zip/active-chatchatscripts.js"></script>

    <script>
        function uploadImage() {
      
      
            document.getElementById('myForm').submit();
        }
      
        function submitForm() {
          alert('hi')
            // Do any additional validation or processing here
            document.getElementById('myForm').submit();
        }
      </script>


<script>
    window.onload = function() {
      // alert('hi')
        var chatContainer = document.getElementById('msg_card_body');
        // var container = document.getElementById("box");
        chatContainer.scrollTop = chatContainer.scrollHeight;
        document.body.scrollTop = document.body.scrollHeight;
  
    };
  
  
    // window.onload = function() {
    //           var container = document.getElementById("box");
    //           container.scrollTop = container.scrollHeight;
    //       };
  
  </script>
	</body>
</html>